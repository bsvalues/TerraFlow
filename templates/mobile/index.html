{% extends 'mobile_layout.html' %}

{% block title %}GeoAssessmentPro | Mobile Dashboard{% endblock %}

{% block content %}
<div class="mobile-container">
    <!-- Welcome Card -->
    <div class="mobile-card mb-4">
        <div class="p-3">
            <h1 class="h4 fw-bold mb-2" style="color: var(--tf-flow-aqua);">Welcome to GeoAssessmentPro</h1>
            <p class="mb-0">Advanced property assessment with real-time anomaly detection.</p>
        </div>
    </div>
    
    <!-- Stats Overview -->
    <div class="row g-2 mb-4">
        <div class="col-6">
            <div class="mobile-stat-card">
                <div class="mobile-stat-value">{{ property_count|default('478') }}</div>
                <div class="mobile-stat-label">Properties</div>
            </div>
        </div>
        <div class="col-6">
            <div class="mobile-stat-card">
                <div class="mobile-stat-value text-danger">{{ anomaly_count|default('12') }}</div>
                <div class="mobile-stat-label">Anomalies</div>
            </div>
        </div>
    </div>
    
    <!-- Quick Actions -->
    <div class="mobile-section-title">Quick Actions</div>
    <div class="row g-2 mb-4">
        <div class="col-6">
            <a href="{{ url_for('map_viewer') }}" class="text-decoration-none">
                <div class="mobile-card p-3 h-100 text-center">
                    <i class="fas fa-map fa-2x mb-2" style="color: var(--tf-map-green);"></i>
                    <div class="fw-bold">View Map</div>
                </div>
            </a>
        </div>
        <div class="col-6">
            <a href="{{ url_for('search_page') }}" class="text-decoration-none">
                <div class="mobile-card p-3 h-100 text-center">
                    <i class="fas fa-search fa-2x mb-2" style="color: var(--tf-insight-violet);"></i>
                    <div class="fw-bold">Search</div>
                </div>
            </a>
        </div>
        <div class="col-6">
            <a href="{{ url_for('assessment_map') }}" class="text-decoration-none">
                <div class="mobile-card p-3 h-100 text-center">
                    <i class="fas fa-home fa-2x mb-2" style="color: var(--tf-map-green);"></i>
                    <div class="fw-bold">Properties</div>
                </div>
            </a>
        </div>
        <div class="col-6">
            <a href="/visualizations/anomaly-map" class="text-decoration-none">
                <div class="mobile-card p-3 h-100 text-center">
                    <i class="fas fa-exclamation-triangle fa-2x mb-2" style="color: #dc3545;"></i>
                    <div class="fw-bold">Anomalies</div>
                </div>
            </a>
        </div>
    </div>
    
    <!-- Recent Activity -->
    <div class="mobile-section-title">Recent Anomalies</div>
    <div class="mobile-card mb-4">
        <ul class="mobile-list">
            {% for i in range(1, 4) %}
                <li class="mobile-list-item">
                    <div class="mobile-list-icon">
                        <i class="fas fa-exclamation-circle text-danger"></i>
                    </div>
                    <div class="mobile-list-content">
                        <div class="mobile-list-title">{{ anomaly_titles[i-1]|default('Property Value Anomaly') }}</div>
                        <div class="mobile-list-subtitle">
                            {{ anomaly_descriptions[i-1]|default('Unusual change detected in property ID #' ~ 10000+i) }}
                        </div>
                    </div>
                    <div class="mobile-list-action">
                        <a href="#" class="btn btn-sm btn-outline-primary">View</a>
                    </div>
                </li>
            {% endfor %}
        </ul>
        <div class="p-3 text-center">
            <a href="/visualizations/anomaly-map" class="btn btn-sm btn-primary">View All Anomalies</a>
        </div>
    </div>
    
    <!-- Recent Properties -->
    <div class="mobile-section-title">Recent Properties</div>
    <div class="mobile-card mb-4">
        <ul class="mobile-list">
            {% for i in range(1, 4) %}
                <li class="mobile-list-item">
                    <div class="mobile-list-icon">
                        <i class="fas fa-home" style="color: var(--tf-map-green);"></i>
                    </div>
                    <div class="mobile-list-content">
                        <div class="mobile-list-title">{{ property_titles[i-1]|default('123' ~ i ~ ' Main Street') }}</div>
                        <div class="mobile-list-subtitle">
                            {{ property_descriptions[i-1]|default('Residential - $' ~ (300000 + i * 25000)) }}
                        </div>
                    </div>
                    <div class="mobile-list-action">
                        <a href="#" class="btn btn-sm btn-outline-primary">View</a>
                    </div>
                </li>
            {% endfor %}
        </ul>
        <div class="p-3 text-center">
            <a href="{{ url_for('assessment_map') }}" class="btn btn-sm btn-primary">View All Properties</a>
        </div>
    </div>
</div>
{% endblock %}

{% block action_button %}
<a href="#" class="action-button" onclick="showBottomSheet()">
    <i class="fas fa-plus"></i>
</a>
{% endblock %}

{% block sheet_title %}Quick Actions{% endblock %}

{% block sheet_content %}
<div class="row g-2">
    <div class="col-6">
        <a href="{{ url_for('file_manager') }}" class="btn btn-outline-primary w-100 p-3 d-flex flex-column align-items-center">
            <i class="fas fa-file mb-2"></i>
            <span>Upload File</span>
        </a>
    </div>
    <div class="col-6">
        <a href="{{ url_for('search_page') }}" class="btn btn-outline-primary w-100 p-3 d-flex flex-column align-items-center">
            <i class="fas fa-search mb-2"></i>
            <span>Search Property</span>
        </a>
    </div>
    <div class="col-6 mt-3">
        <a href="{{ url_for('map_viewer') }}" class="btn btn-outline-primary w-100 p-3 d-flex flex-column align-items-center">
            <i class="fas fa-map mb-2"></i>
            <span>View Map</span>
        </a>
    </div>
    <div class="col-6 mt-3">
        <a href="/visualizations/anomaly-map" class="btn btn-outline-danger w-100 p-3 d-flex flex-column align-items-center">
            <i class="fas fa-exclamation-triangle mb-2"></i>
            <span>Check Anomalies</span>
        </a>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
    // Sample script to handle dynamic content loading
    document.addEventListener('DOMContentLoaded', function() {
        // This is where we could add code to fetch real-time data
        console.log('Mobile dashboard initialized');
        
        // Example of how we might fetch real anomalies
        /*
        fetch('/api/anomalies/recent')
            .then(response => response.json())
            .then(data => {
                // Update UI with real anomaly data
                console.log('Fetched anomaly data:', data);
            })
            .catch(error => {
                console.error('Error fetching anomalies:', error);
            });
        */
    });
</script>
{% endblock %}